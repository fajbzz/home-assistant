- id: '1646172012797'
  alias: Lys uten Hue
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 0da02203702a99b5cb616c8fcea949c1
    type: action
    subtype: off-press
    discovery_id: 0x00178801020e912a action_off_press_release
    id: off_press
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: off_press
      sequence:
      - condition: time
        after: '21:00'
        before: '05:00'
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.kitchen_lights
    default: []
  mode: single

- id: '1653390572240'
  alias: Kjøkken på svakt på kvelden
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.bevegelse_kjokken_occupancy
  condition:
  - condition: device
    type: is_on
    device_id: 2b2fb3d0e3b9d5a4815a9120de84afbb
    entity_id: light.livingroom_lights
    domain: light
  - condition: template
    value_template: '{{ states.automation.kjokken_pa_svakt_pa_kvelden.attributes.current == 0 }}'
  action:
  - choose:
    - conditions:
      - type: is_motion
        condition: device
        device_id: 31f5236faab8ab70132e1e5bb341a5d8
        entity_id: binary_sensor.bevegelse_kjokken_occupancy
        domain: binary_sensor
      sequence:
      - type: turn_on
        device_id: 2336ec55a36729c3797ce9e76358ed13
        entity_id: light.kitchen_lights
        domain: light
        brightness_pct: 95
    default:
    - type: turn_on
      device_id: 2336ec55a36729c3797ce9e76358ed13
      entity_id: light.kitchen_lights
      domain: light
      brightness_pct: 30
  mode: single

- id: '1652905890675'
  alias: Styr lys i gangen
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.shellygang_input
  - platform: state
    entity_id: sensor.howmanyhome
  - platform: template
    value_template: "{{ states.binary_sensor.inngangsdor_door_window.state == 'on' }}"
  - platform: template
    value_template: "{{ states.sensor.pvlogger_power.state|int > 200 and states.switch.shellygang.state == 'off' and states.binary_sensor.anyone_home.state == 'on' }}"
    id: morning_light
  - platform: template
    value_template: "{{ now().timestamp() - states.binary_sensor.inngangsdor_door_window.last_updated.timestamp() > 600}}"
  condition: 
  - condition: template
    value_template: '{{ states.automation.styr_lys_i_gangen.attributes.current == 0 }}'
  - condition: not
    conditions:
    - condition: template
      value_template: "{{ states('sensor.howmanyhome') == 'unknown' }}"

  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning_light
      sequence:
      - service: light.turn_on
        data:
          brightness: 100
        target:
          entity_id: light.paere_toalett
    - conditions:
      - condition: state
        entity_id: binary_sensor.shellygang_input
        state: 'off'
      sequence:
      - service: light.turn_on
        data:
          brightness: 4
        target:
          entity_id: light.hallway_lights
      - service: light.turn_on
        data:
          brightness: 40
        target:
          entity_id: light.paere_toalett
    - conditions:
      - condition: template
        value_template: '{{ states.sensor.howmanyhome.state|int(default=0) == 0 }}'
      - condition: template
        value_template: "{{ states.binary_sensor.inngangsdor_door_window.state == 'off' }}"
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.hallway_lights
        data: {}
      - service: light.turn_on
        data:
          brightness: 40
        target:
          entity_id: light.paere_toalett
    default:
    - service: light.turn_on
      data:
        brightness: 204
      target:
        entity_id: light.hallway_lights
    - service: light.turn_on
      data:
        brightness: 200
      target:
        entity_id: light.paere_toalett
  mode: single
