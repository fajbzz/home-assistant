- id: '1648480653301'
  alias: kjølerom
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.lumi_kjole_temperature'')|float > 7.0 }}'
  - platform: template
    value_template: '{{ states(''sensor.lumi_kjole_temperature'')|float < 4.0 }}'
  - platform: template
    value_template: >
      {% if states.binary_sensor.kjolerom_on.state %}
        {{ now().timestamp() - as_timestamp(states.binary_sensor.kjolerom_on.last_updated) > 10500 }}
      {% else %}
        {{ false }}
      {% endif %}
  - platform: template
    value_template: >
      {% if states.binary_sensor.kjolerom_on.state %}
        {{ now().timestamp() - as_timestamp(states.binary_sensor.kjolerom_on.last_updated) > 10800 }}
      {% else %}
        {{ false }}
      {% endif %}
  - platform: state
    entity_id: binary_sensor.anyone_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    to: 'on'
  - platform: time
    at: 07:30
  - platform: time
    at: '10:30'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.lumi_kjole_temperature'')|float > 7.0 }}'
      sequence:
      - type: turn_on
        device_id: 65e4d0e17a9d7119c81824d5c4fadff0
        entity_id: switch.shellykjolplus_switch_0
        domain: switch
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.lumi_kjole_temperature'')|float < 4.0 }}'
      sequence:
      - type: turn_off
        device_id: 65e4d0e17a9d7119c81824c4fadff0
        entity_id: switch.shellykjolplus_switch_0
        domain: switch
    - conditions:
      - condition: template
        value_template: '{{ now().timestamp() - as_timestamp(states.binary_sensor.kjolerom_on.last_updated)
          > 10800 }}'
      - condition: or
        conditions:
        - condition: time
          after: 07:00
          before: '22:00'
          weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
        - condition: time
          after: 09:00
          before: '22:00'
          weekday:
          - sat
          - sun
      - condition: state
        entity_id: binary_sensor.anyone_home
        state: 'on'
      sequence:
      - service: media_player.volume_set
        data:
          volume_level: 0.3
        target:
          entity_id: media_player.stue
      - service: tts.google_translate_say
        data:
          entity_id: media_player.stue
          language: 'no'
          message: 'Har kjølerommet hengt seg opp ? '
    - conditions:
      - condition: template
        value_template: '{{ now().timestamp() - as_timestamp(states.binary_sensor.kjolerom_on.last_updated) > 3600 * 2.9 }}'
      sequence:
      - type: toggle
        device_id: 65e4d0e17a9d7119c81824d5c4fadff0
        entity_id: switch.shellykjolplus_switch_0
        domain: switch
    default: []
  mode: single

