- id: '1644843799898'
  alias: Kontortemp
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.hjemmekontor
    id: hjemmekontorvalg
  - platform: state
    entity_id: climate.adax_faoff
    attribute: current_temperature
    id: currenttemp
  - platform: state
    entity_id: input_number.kontor_temperatur
    id: targettemp
  - platform: time
    at: 07:00
    id: morgen
  - platform: time
    at: '16:00'
    id: ettermiddag
  - platform: template
    value_template: '{{ now().timestamp() - as_timestamp(states.person.finn_arne_johansen.last_changed) > 1800 }}'
    id: finnarneaway
  - platform: template
    value_template: '{{ now().timestamp() - as_timestamp(states.climate.adax_faoff.last_updated) > 3600 }}'
    id: lost_connection
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ now().timestamp() - as_timestamp(states.person.finn_arne_johansen.last_changed) > 1800 }}'
      - condition: state
        entity_id: input_boolean.hjemmekontor
        state: 'on'
      - condition: time
        after: 07:00
        before: '16:00'
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: person.finn_arne_johansen
        state: 'not_home'
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.hjemmekontor
    default: []
  - choose:
    - conditions:
      - condition: trigger
        id: lost_connection
      sequence:
      - service: notify.mobile_app_xq_au52
        data:
          message: Mistet forbindelsen til adax FA kontor
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_boolean.hjemmekontor
          state: 'on'
        - condition: time
          after: 05:00
          before: '16:00'
          weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
        - condition: numeric_state
          entity_id: input_number.kontor_temperatur
          below: '19'
        sequence:
        - service: input_number.set_value
          data:
            value: 19
          target:
            entity_id: input_number.kontor_temperatur
      - conditions:
        - condition: numeric_state
          entity_id: input_number.kontor_temperatur
          above: '18.9'
        - condition: or
          conditions:
          - condition: state
            entity_id: input_boolean.hjemmekontor
            state: 'off'
          - condition: not
            conditions:
            - condition: time
              after: 05:00
              before: '16:00'
              weekday:
              - mon
              - tue
              - wed
              - thu
              - fri
        sequence:
        - service: input_number.set_value
          data:
            value: 14
          target:
            entity_id: input_number.kontor_temperatur
      default: []
    - choose:
      - conditions:
        - condition: template
          value_template: '{{ state_attr(''climate.adax_faoff'',''current_temperature'')
            >= states(''input_number.kontor_temperatur'')|float }}'
        - condition: template
          value_template: '{{ state_attr(''climate.adax_faoff'',''temperature'') > states(''input_number.kontor_temperatur'')|float }}'
        sequence:
        - service: climate.set_temperature
          data:
            temperature: '{{ states(''input_number.kontor_temperatur'')| int - 1 }}'
          target:
            entity_id: climate.adax_faoff
      - conditions:
        - condition: template
          value_template: '{{ state_attr(''climate.adax_faoff'',''current_temperature'')
            <= states(''input_number.kontor_temperatur'')|float }}'
        - condition: template
          value_template: '{{ states(''input_number.kontor_temperatur'')|float > state_attr(''climate.adax_faoff'',''temperature'')
            }}'
        sequence:
        - service: climate.set_temperature
          data:
            temperature: '{{ states(''input_number.kontor_temperatur'')| int + 4 }}'
          target:
            entity_id: climate.adax_faoff
      default: []
  mode: single
